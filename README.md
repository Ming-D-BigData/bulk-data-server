# Bulk Data Server

<a href="https://bulk-data.smarthealthit.org" target="_blank">Online Demo</a>


## Installation
First you have to install NodeJS if you don't already have it from https://nodejs.org/. This app has been developed on Node version 7.9 and also tested on Node 8. In case you have older version you might need to also install a newer one. This is easy to do using the Node Version Manager from https://github.com/creationix/nvm. Then clone the repo, install the dependencies and start it:

```sh
git clone https://github.com/smart-on-fhir/bulk-data-server.git
cd bulk-data-server
npm i
npm start
```
You will see something like "Example app listening on http://localhost:9443". Load that URL in your browser to get started.

## Using your own data
1. Use the <a href="https://synthetichealth.github.io/synthea/" target="_blank">Synthea Patient Generator</a> to generate some STU3 patients.
2. Use our importer script to import those synthea patients into our database:
   ```sh
   node import -d /path/to/my/patients/
   ```

## Configuration

You can customize your settings by editing the file `config.js`. You can also pass the following environment variables:

- `NODE_ENV` - Typically this is `production`, `development` or `test`. Defaults to `production`.
- `PORT` - The port to listen on. Defaults to `9444` for running tests and `9443` otherwise.
- `BASE_URL` - The base url for the link generation. Defaults to `http://localhost:${PORT}`.
- `SECRET` - The secret for signing jwt tokens. Defaults to "this-is-our-big-secret". You must set this one.

## Usage
This is sample bulk-data server that can be used by bulk-data clients like [FHIR Downloader](https://github.com/smart-on-fhir/sample-apps-stu3/tree/master/fhir-downloader). All you need is to know the server's fhir URL which can be copied from the "FHIR Server URL" field. Then, assuming that you have installed the above app, you can just run it using `node . -f "The fhir server url" -d /dev/null`. That should connect and download everything (without actually writing files anywhere).

Note that changing some UI options will generate new FHIR URL (the changed fields will flash in green for a while). In that case you should copy the new "FHIR Server URL" and pass it to the client.

This server can also handle authentication using the "backend services" standard. To use it you should have a pair of RS256 private and public keys (we only require you to provide the public key here). Alternatively, you can generate them by clicking on the "Generate Keys" button. The other required piece is the "Service URL" which acts more like an unique identifier of your client. Once you have the public key and the service uri, we will generate a `Client ID` for you. At that point you will have everything that is needed to implement the http://docs.smarthealthit.org/authorization/backend-services/. You can also download these settings as JSON using the "Download as JSON" button. The settings include:
- `private_key` - Only included if generated by us, only used in your client.
- `client_id` - client_id to send while authorizing
- `fhir_url` - where to send your FHIR requests
- `token_url` - where to send your authorization requests
- `service_url` - client identifier



